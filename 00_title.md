<!-- markdownlint-disable MD012 MD014 -->

# Introduction to Vulnerability Scanning



## What is CVE

* CVE = Common Vulnerabilities and Exposures

> Unique, common identifiers for publicly known information-security vulnerabilities in publicly released software packages
([Wikipedia](https://en.wikipedia.org/wiki/Common_Vulnerabilities_and_Exposures))

* https://cve.mitre.org/
* https://nvd.nist.gov/vuln/full-listing


## Example

* https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-11693
> An issue was discovered in LibSass through 3.5.4. An out-of-bounds read of a memory region was found in the function Sass::Prelexer::skip_over_scopes which could be leveraged by an attacker to disclose information or manipulated to read from unmapped memory causing a denial of service.


## Scanning for vulnerabilties

* Operating system
  * Installed software packages
* Docker container images
* Application
  * Used libraries and frameworks

* Left-shift security
  * Integration into CI/ CD



### [GitHub](https://github.com/stefanfreitag/introToAwsMsk/issues/18)

* Scanning via integrations with GitHub apps, e.g. Whitesource Bolt
* Scan is executed on every commit

<img src="images/whitesource_bolt_found_vulnerabilities.png" alt="" height="300px"/>


Findings

<img src="images/whitesource_bolt_overview.png" alt="" height="600px"/>

CVSS = Commomn Vulnerability Scoring System


[Details](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-9251)

<img src="images/whitesource_bolt_example.png" alt="" height="600px"/>



### Container image scanning

* Various Docker image registries exist
  * [DockerHub](https://hub.docker.com/)
  * [AWS Elastic Container Registry](https://aws.amazon.com/de/ecr/)
  * [Google Container Registry](https://cloud.google.com/container-registry/?hl=de)
  * Self-hosted


#### AWS ECR

_Scan on Push_ feature

<img src="images/aws_ecr_repositories.png" alt="" height="450px"/>


Scanned images with high level information

<img src="images/aws_ecr_repositories_coretto_8.png" alt="" height="550px"/>


Detailed information of a scan

<img src="images/aws_ecr_repositories_coretto_8_scan_result.png" alt="" height="600px"/>


Retrieval via CLI

~~~bash
$ aws ecr describe-image-scan-findings
    --repository-name=coretto-8
    --image-id imageTag=latest | jq
        -r '.imageScanFindings.findingSeverityCounts'

{
  "LOW": 1,
  "MEDIUM": 2
}
~~~


#### trivy

> A Simple and Comprehensive Vulnerability Scanner for Containers, Suitable for CI.

<img src="images/trivy_scan_corretto_8.png" alt="" height="400px"/>


| OS  | Supported Versions  | Target Packages |
|  --- | ---  | --- |
| Alpine Linux  | 2.2 - 2.7, 3.0 - 3.10 |  apk |
| RH UBI  | 7, 8  | yum/rpm |  
| RHEL  | 6, 7, 8 | yum/rpm |
| CentOS |  6, 7  | yum/rpm |
| Amazon Linux| 1, 2  | apt/apt-get/dpkg |
| Debian  | wheezy, jessie, stretch, buster | apt/apt-get/dpkg |
| Ubuntu  | 16.04, 18.04, 18.10, 19.04 | apt/apt-get/dpkg |
| Distroless  | Any | apt/apt-get/dpkg |

Distroless: https://github.com/GoogleContainerTools/distroless

UBI: Universal Base Image


Trivy automatically detects the following files in the container and scans vulnerabilities in the application dependencies.

* Gemfile.lock
* Pipfile.lock
* poetry.lock
* composer.lock
* package-lock.json
* yarn.lock
* Cargo.lock



## Scanning for Java based projects

* OWASP Dependency-Check
* Supports Java and .NET


Invocation

* Command Line
* Ant Task
* Maven Plugin
* Gradle Plugin

Other Plugins

* Jenkins Plugin
* sbt Plugin
* SonarQube Plugin


### Gradle Plugin

~~~
plugins {
    id "fr.brouillard.oss.gradle.jgitver" version "0.10.0-rc01"
    id "io.franzbecker.gradle-lombok" version "3.2.0"
    id "java"
    id "idea"
    id "org.owasp.dependencycheck" version "5.2.4"
}
~~~

<img src="images/gradle_tasks.png" alt="" height="350px"/>


| Task| Description |
| --- | ---|
|dependencyCheckAnalyze | Runs dependency-check against the project and generates a report.
|dependencyCheckAggregate | Runs dependency-check against a multi-project build and generates a report.
|dependencyCheckUpdate | Updates the local cache of the NVD data from NIST.
|dependencyCheckPurge | Deletes the local copy of the NVD. This is used to force a refresh of the data.


Scan information

<img src="images/gradle_tasks.png" alt="" height="350px"/>


Specifies if the build should be failed if a CVSS score equal to or above a specified level is identified.

~~~
dependencyCheck {
    failBuildOnCVSS=6
}
~~~

<img src="images/gradle_scan_failed_job.png" alt="" height="350px"/>


## Scanning for Angular based projects




## Further information

* [AquaSec trivy](https://github.com/aquasecurity/trivy)
* [Clair](https://coreos.com/clair/docs/latest/)
* [Dependency-Check](https://jeremylong.github.io/DependencyCheck/dependency-check-gradle/index.html)
* [Whitesource Bolt](https://bolt.whitesourcesoftware.com/)
* [Wikipedia on CVE](https://en.wikipedia.org/wiki/Common_Vulnerabilities_and_Exposures)
* [Wikipedia on CVE Scoring System](https://en.wikipedia.org/wiki/Common_Vulnerability_Scoring_System)
